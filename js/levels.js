// ============================================================
//  levels.js — Данные всех зон: платформы, шипы, враги, боссы
//  ENHANCED: Увеличенные карты (7000px+), паркур, широкие арены
// ============================================================

'use strict';

// ══════════════════════════════════════════════════════════
//  ZONE 1 — БЕЗДНА (Abyss)
// ══════════════════════════════════════════════════════════
const ABYSS_W = 7500, ABYSS_H = 1400;
const AGY = ABYSS_H - 80;

const ABYSS = {
  id: 'abyss', name: 'БЕЗДНА', sub: 'Зона I — Проклятый Чертог',
  bg: ['#080812', '#1a0830'], ground: ['#252038', '#120e22'], plat: ['#382655', '#1c1230'],
  accent: '#7a50c8', fog: [260, 60, 18], stars: true,
  ambColor: '#b080ff', ambAlt: '#60c0ff',
  W: ABYSS_W, H: ABYSS_H, GY: AGY,
  playerStart: [150, AGY - 80],
  // Арена босса 800px шириной
  bossX: 6600, bossY: AGY - 130, bossType: 'king',
  dialog: {
    npc: '◈ Призрак Стражника', lines: [
      'Ты вошёл в Бездну, путник. Немногие решаются.',
      'Король этих земель пал в тьму. Его тень ещё бродит здесь.',
      'Тоннели стали шире, а пропасти — глубже. Осторожнее.',
      'Лишь победив Короля Пустоты, ты откроешь путь дальше.'
    ]
  },
  plats: [
    // ── ГРУНТ ──
    { x: 0, y: AGY, w: 1200, h: 80, t: 'G' },
    // Пропасть 1
    { x: 1500, y: AGY, w: 800, h: 80, t: 'G' },
    // Пропасть 2
    { x: 2800, y: AGY, w: 1200, h: 80, t: 'G' },
    // Пропасть 3
    { x: 4500, y: AGY, w: 3000, h: 80, t: 'G' }, // До конца арены

    // ── СТАРТОВАЯ ЗОНА (0 - 1500) ──
    { x: 300, y: AGY - 150, w: 200, h: 20, t: 'P' },
    { x: 600, y: AGY - 280, w: 180, h: 20, t: 'P' },
    { x: 900, y: AGY - 180, w: 160, h: 20, t: 'P' },

    // ПАРКУР НАД ПРОПАСТЬЮ 1 (1200 - 1500)
    { x: 1250, y: AGY - 250, w: 100, h: 20, t: 'P' },
    { x: 1400, y: AGY - 400, w: 80, h: 20, t: 'P' },

    // ── ВТОРАЯ ЗОНА (1500 - 2800) ──
    { x: 1600, y: AGY - 150, w: 200, h: 20, t: 'P' },
    { x: 1850, y: AGY - 300, w: 180, h: 20, t: 'P' },
    { x: 2100, y: AGY - 450, w: 160, h: 20, t: 'P' },
    { x: 2350, y: AGY - 250, w: 200, h: 20, t: 'P' },
    { x: 2600, y: AGY - 150, w: 150, h: 20, t: 'P' },

    // Вертикальный паркур-колодец
    { x: 1950, y: AGY - 600, w: 20, h: 300, t: 'W' },
    { x: 2200, y: AGY - 700, w: 20, h: 300, t: 'W' },
    { x: 2000, y: AGY - 800, w: 150, h: 20, t: 'P' },

    // ПАРКУР НАД ПРОПАСТЬЮ 2 (2300 - 2800)
    { x: 2850, y: AGY - 200, w: 120, h: 20, t: 'P' },
    { x: 3050, y: AGY - 350, w: 100, h: 20, t: 'P' },
    { x: 3250, y: AGY - 500, w: 120, h: 20, t: 'P' },
    { x: 3500, y: AGY - 350, w: 150, h: 20, t: 'P' },

    // ── ТРЕТЬЯ ЗОНА (2800 - 4500) ──
    { x: 3700, y: AGY - 180, w: 200, h: 20, t: 'P' },
    { x: 4000, y: AGY - 300, w: 180, h: 20, t: 'P' },
    { x: 4300, y: AGY - 150, w: 160, h: 20, t: 'P' },

    // ПАРКУР НАД ПРОПАСТЬЮ 3 (4000 - 4500)
    { x: 4600, y: AGY - 250, w: 120, h: 20, t: 'P' },
    { x: 4800, y: AGY - 400, w: 100, h: 20, t: 'P' },
    { x: 5000, y: AGY - 550, w: 120, h: 20, t: 'P' },
    { x: 5250, y: AGY - 400, w: 150, h: 20, t: 'P' },
    { x: 5500, y: AGY - 200, w: 200, h: 20, t: 'P' },

    // ── ПРЕДБОССОВАЯ АЛЛЕЯ (4500 - 5800) ──
    { x: 5800, y: AGY - 150, w: 800, h: 20, t: 'P' },

    // ── БОССОВАЯ АРЕНА (5800 - 7500) ──
    // Боевые платформы для прыжков
    { x: 6100, y: AGY - 250, w: 150, h: 20, t: 'P' },
    { x: 6450, y: AGY - 380, w: 150, h: 20, t: 'P' },
    { x: 6800, y: AGY - 250, w: 150, h: 20, t: 'P' },

    // Границы
    { x: 7495, y: 0, w: 5, h: ABYSS_H, t: 'W' },
  ],
  spikes: [
    // Шипы на грунте
    { x: 800, y: AGY - 20, w: 100, h: 20 },
    { x: 1700, y: AGY - 20, w: 120, h: 20 },
    { x: 3800, y: AGY - 20, w: 150, h: 20 },
    // Шипы в ямах
    { x: 1200, y: AGY + 60, w: 300, h: 20 },
    { x: 2300, y: AGY + 60, w: 500, h: 20 },
    { x: 4100, y: AGY + 60, w: 400, h: 20 },
  ],
  bonfires: [
    { x: 200, y: AGY - 170 },
    { x: 1650, y: AGY - 170 },
    { x: 3800, y: AGY - 170 },
    { x: 5600, y: AGY - 170 }, // Перед боссом
  ],
  enemies: [
    { type: 'wraith', x: 700, y: AGY - 80, p1: 600, p2: 800 },
    { type: 'shield', x: 1000, y: AGY - 80, p1: 950, p2: 1150 },

    // На платформах
    { type: 'wraith', x: 1850, y: AGY - 380, p1: 1800, p2: 2000 },
    { type: 'shield', x: 2400, y: AGY - 330, p1: 2350, p2: 2550 },

    // Зона 3
    { type: 'wraith', x: 2900, y: AGY - 80, p1: 2850, p2: 3200 },
    { type: 'shield', x: 3400, y: AGY - 80, p1: 3350, p2: 3600 },
    { type: 'wraith', x: 4200, y: AGY - 80, p1: 4100, p2: 4400 },

    // Аллея перед боссом
    { type: 'shield', x: 4900, y: AGY - 80, p1: 4800, p2: 5100 },
    { type: 'wraith', x: 5300, y: AGY - 80, p1: 5200, p2: 5400 },
  ]
};

// ══════════════════════════════════════════════════════════
//  ZONE 2 — КАТАКОМБЫ (Catacombs)
// ══════════════════════════════════════════════════════════
const CAT_W = 6800, CAT_H = 1300;
const CGY = CAT_H - 80;

const CATACOMBS = {
  id: 'catacombs', name: 'КАТАКОМБЫ', sub: 'Зона II — Залы Костей',
  bg: ['#0a0806', '#201408'], ground: ['#3a2810', '#1e1408'], plat: ['#4a3520', '#2a1e10'],
  accent: '#c87820', fog: [30, 40, 15], stars: false,
  ambColor: '#ff8830', ambAlt: '#ffcc44',
  W: CAT_W, H: CAT_H, GY: CGY,
  playerStart: [150, CGY - 80],
  bossX: 5900, bossY: CGY - 140, bossType: 'lich',
  dialog: {
    npc: '◈ Древний Скелет', lines: [
      'Кости... говорят. Живой вступил в наши залы.',
      'Лабиринт стал ещё запутаннее. Не сорвись на шипы.',
      'Его черепа метки. Двигайся, не стой на одном месте.',
      'Разбей корону Лича — лишь так он падёт навсегда.'
    ]
  },
  plats: [
    // ── ГРУНТ ──
    { x: 0, y: CGY, w: 1000, h: 80, t: 'G' },
    { x: 1300, y: CGY, w: 800, h: 80, t: 'G' },
    { x: 2400, y: CGY, w: 1200, h: 80, t: 'G' },
    { x: 3900, y: CGY, w: 2900, h: 80, t: 'G' }, // До босса

    // ── СТАРТ (0 - 1300) ──
    { x: 400, y: CGY - 180, w: 200, h: 20, t: 'P' },
    { x: 700, y: CGY - 300, w: 150, h: 20, t: 'P' },

    // Паркур яма 1
    { x: 1050, y: CGY - 250, w: 80, h: 20, t: 'P' },
    { x: 1200, y: CGY - 400, w: 80, h: 20, t: 'P' },

    // ── ЦЕНТР (1300 - 2400) ──
    { x: 1450, y: CGY - 200, w: 180, h: 20, t: 'P' },
    { x: 1750, y: CGY - 350, w: 160, h: 20, t: 'P' },
    { x: 2000, y: CGY - 200, w: 200, h: 20, t: 'P' },

    // Лабиринт стенок
    { x: 1600, y: CGY - 600, w: 20, h: 250, t: 'W' },
    { x: 1850, y: CGY - 750, w: 20, h: 300, t: 'W' },

    // Паркур яма 2 с шипами
    { x: 2150, y: CGY - 300, w: 80, h: 20, t: 'P' },
    { x: 2300, y: CGY - 450, w: 80, h: 20, t: 'P' },

    // ── ЗОНА 3 (2400 - 3900) ──
    { x: 2500, y: CGY - 250, w: 200, h: 20, t: 'P' },
    { x: 2800, y: CGY - 400, w: 150, h: 20, t: 'P' },
    { x: 3100, y: CGY - 250, w: 180, h: 20, t: 'P' },
    { x: 3400, y: CGY - 400, w: 160, h: 20, t: 'P' },

    // Подземный мост
    { x: 2600, y: CGY - 600, w: 800, h: 20, t: 'P' },

    // Паркур яма 3
    { x: 3650, y: CGY - 300, w: 90, h: 20, t: 'P' },
    { x: 3800, y: CGY - 450, w: 90, h: 20, t: 'P' },

    // ── ПРЕДБОСС (3900 - 5200) ──
    { x: 4100, y: CGY - 200, w: 200, h: 20, t: 'P' },
    { x: 4400, y: CGY - 350, w: 180, h: 20, t: 'P' },
    { x: 4700, y: CGY - 200, w: 220, h: 20, t: 'P' },
    { x: 5000, y: CGY - 300, w: 150, h: 20, t: 'P' },

    // ── АРЕНА ЛИЧА (5200 - 6800) ──
    // Платформы для уклонения от заклинаний
    { x: 5400, y: CGY - 250, w: 160, h: 20, t: 'P' },
    { x: 5800, y: CGY - 400, w: 200, h: 20, t: 'P' },
    { x: 6200, y: CGY - 250, w: 160, h: 20, t: 'P' },

    { x: 6795, y: 0, w: 5, h: CAT_H, t: 'W' },
  ],
  spikes: [
    { x: 800, y: CGY - 20, w: 150, h: 20 },
    { x: 1400, y: CGY - 20, w: 100, h: 20 },
    { x: 2900, y: CGY - 20, w: 180, h: 20 },
    { x: 4500, y: CGY - 20, w: 150, h: 20 },
    // В ямах
    { x: 1000, y: CGY + 60, w: 300, h: 20 },
    { x: 2100, y: CGY + 60, w: 300, h: 20 },
    { x: 3600, y: CGY + 60, w: 300, h: 20 },
  ],
  bonfires: [
    { x: 200, y: CGY - 170 },
    { x: 1350, y: CGY - 170 },
    { x: 3000, y: CGY - 170 },
    { x: 4800, y: CGY - 170 }, // Перед боссом
  ],
  enemies: [
    { type: 'warrior', x: 600, y: CGY - 80, p1: 500, p2: 750 },
    { type: 'archer', x: 1500, y: CGY - 80, p1: 1400, p2: 1700 },

    // На платформах
    { type: 'archer', x: 2700, y: CGY - 680, p1: 2650, p2: 3200 }, // Снайпер на мосту
    { type: 'warrior', x: 2550, y: CGY - 330, p1: 2500, p2: 2650 },

    { type: 'warrior', x: 2600, y: CGY - 80, p1: 2500, p2: 2800 },
    { type: 'archer', x: 3200, y: CGY - 80, p1: 3100, p2: 3400 },

    { type: 'warrior', x: 4200, y: CGY - 80, p1: 4000, p2: 4300 },
    { type: 'archer', x: 4600, y: CGY - 80, p1: 4500, p2: 4800 },
    { type: 'warrior', x: 5000, y: CGY - 80, p1: 4900, p2: 5100 },
  ]
};

// ══════════════════════════════════════════════════════════
//  ZONE 3 — ГРОЗОВЫЕ ВЕРШИНЫ (Storm Peaks)
// ══════════════════════════════════════════════════════════
const PKS_W = 7800, PKS_H = 1500;
const PGY = PKS_H - 80;

const PEAKS = {
  id: 'peaks', name: 'ГРОЗОВЫЕ ВЕРШИНЫ', sub: 'Зона III — Трон Бури',
  bg: ['#040810', '#081828'], ground: ['#102040', '#081428'], plat: ['#183060', '#0a1e3a'],
  accent: '#00c8ff', fog: [200, 60, 20], stars: true,
  ambColor: '#80ddff', ambAlt: '#ffffff',
  W: PKS_W, H: PKS_H, GY: PGY,
  playerStart: [150, PGY - 80],
  bossX: 6800, bossY: PGY - 160, bossType: 'titan',
  dialog: {
    npc: '◈ Буревестник', lines: [
      'Вершины не принимают слабых. Ветер сдувает неосторожных.',
      'Титан Бури ждёт на самой высокой точке.',
      'Прыгай точно. Иначе упадёшь в бездну облаков.',
      'Победи его — и небо над миром станет чистым.'
    ]
  },
  plats: [
    // ── ГРУНТ (Разорванный) ──
    { x: 0, y: PGY, w: 800, h: 80, t: 'G' },
    { x: 1100, y: PGY, w: 700, h: 80, t: 'G' },
    { x: 2100, y: PGY, w: 600, h: 80, t: 'G' },
    { x: 3000, y: PGY, w: 800, h: 80, t: 'G' },
    { x: 4100, y: PGY, w: 3700, h: 80, t: 'G' }, // Предбосс и Арена

    // ── СТАРТ (0 - 1100) ──
    { x: 300, y: PGY - 200, w: 180, h: 20, t: 'P' },
    { x: 600, y: PGY - 350, w: 150, h: 20, t: 'P' },

    // Паркур-прыжки (800 - 1100)
    { x: 850, y: PGY - 200, w: 80, h: 20, t: 'P' },
    { x: 1000, y: PGY - 350, w: 80, h: 20, t: 'P' },

    // ── ЗОНА 2 (1100 - 2100) ──
    { x: 1200, y: PGY - 180, w: 200, h: 20, t: 'P' },
    { x: 1500, y: PGY - 350, w: 160, h: 20, t: 'P' },
    { x: 1750, y: PGY - 500, w: 180, h: 20, t: 'P' },

    // Длинный паркур
    { x: 1850, y: PGY - 250, w: 80, h: 20, t: 'P' },
    { x: 1950, y: PGY - 400, w: 80, h: 20, t: 'P' },
    { x: 2050, y: PGY - 550, w: 80, h: 20, t: 'P' },

    // ── ЗОНА 3 (2100 - 3000) ──
    { x: 2200, y: PGY - 200, w: 180, h: 20, t: 'P' },
    { x: 2500, y: PGY - 400, w: 150, h: 20, t: 'P' },
    { x: 2750, y: PGY - 250, w: 160, h: 20, t: 'P' },

    // Ветряные колонны
    { x: 2350, y: PGY - 800, w: 30, h: 400, t: 'W' },
    { x: 2650, y: PGY - 900, w: 30, h: 500, t: 'W' },

    // Паркур
    { x: 2850, y: PGY - 400, w: 60, h: 20, t: 'P' },

    // ── ЗОНА 4 (3000 - 4100) ──
    { x: 3100, y: PGY - 250, w: 220, h: 20, t: 'P' },
    { x: 3400, y: PGY - 450, w: 180, h: 20, t: 'P' },
    { x: 3700, y: PGY - 300, w: 200, h: 20, t: 'P' },

    // Хардкорный паркур перед боссом
    { x: 3850, y: PGY - 500, w: 80, h: 20, t: 'P' },
    { x: 3950, y: PGY - 700, w: 80, h: 20, t: 'P' },
    { x: 4050, y: PGY - 500, w: 80, h: 20, t: 'P' },

    // ── ПРЕДБОСС & АРЕНА (4100 - 7800) ──
    { x: 4300, y: PGY - 200, w: 250, h: 20, t: 'P' },
    { x: 4700, y: PGY - 400, w: 200, h: 20, t: 'P' },
    { x: 5100, y: PGY - 250, w: 220, h: 20, t: 'P' },
    { x: 5500, y: PGY - 450, w: 180, h: 20, t: 'P' },

    // АРЕНА (6000 - 7800)
    // 3 яруса платформ для сложных воздушных боёв
    { x: 6200, y: PGY - 250, w: 150, h: 20, t: 'P' },
    { x: 6700, y: PGY - 450, w: 200, h: 20, t: 'P' },
    { x: 7200, y: PGY - 250, w: 150, h: 20, t: 'P' },

    { x: 7795, y: 0, w: 5, h: PKS_H, t: 'W' },
  ],
  spikes: [
    { x: 500, y: PGY - 20, w: 80, h: 20 },
    { x: 1300, y: PGY - 20, w: 120, h: 20 },
    { x: 2300, y: PGY - 20, w: 150, h: 20 },
    { x: 3200, y: PGY - 20, w: 120, h: 20 },
    { x: 4400, y: PGY - 20, w: 200, h: 20 },
    { x: 5000, y: PGY - 20, w: 150, h: 20 },
    // Смертельные ямы внизу
    { x: 800, y: PGY + 60, w: 300, h: 20 },
    { x: 1800, y: PGY + 60, w: 300, h: 20 },
    { x: 2700, y: PGY + 60, w: 300, h: 20 },
    { x: 3800, y: PGY + 60, w: 300, h: 20 },
  ],
  bonfires: [
    { x: 200, y: PGY - 170 },
    { x: 1150, y: PGY - 170 },
    { x: 3050, y: PGY - 170 },
    { x: 5800, y: PGY - 170 }, // Перед ареной
  ],
  enemies: [
    { type: 'thunder', x: 650, y: PGY - 80, p1: 580, p2: 750 },
    { type: 'drake', x: 1400, y: PGY - 200, p1: 1200, p2: 1700 },

    // На платформах
    { type: 'drake', x: 2600, y: PGY - 500, p1: 2400, p2: 2800 },
    { type: 'thunder', x: 2300, y: PGY - 80, p1: 2200, p2: 2500 },

    { type: 'thunder', x: 3200, y: PGY - 80, p1: 3100, p2: 3500 },
    { type: 'drake', x: 3600, y: PGY - 400, p1: 3400, p2: 3800 },

    // Предбосская аллея
    { type: 'thunder', x: 4300, y: PGY - 80, p1: 4200, p2: 4500 },
    { type: 'drake', x: 4800, y: PGY - 300, p1: 4600, p2: 5200 },
    { type: 'thunder', x: 5300, y: PGY - 80, p1: 5200, p2: 5600 },
  ]
};

// ── Реестр зон ────────────────────────────────────────────
const ZONE_DEFS = { abyss: ABYSS, catacombs: CATACOMBS, peaks: PEAKS };
const ZONE_ORDER = ['abyss', 'catacombs', 'peaks'];

// ── Карта мира — узлы зон ────────────────────────────────
const zoneNodes = [
  { id: 'abyss', name: 'БЕЗДНА', sub: 'Зона I', x: .2, y: .55, boss: 'Король Пустоты', color: '#9f7fe8' },
  { id: 'catacombs', name: 'КАТАКОМБЫ', sub: 'Зона II', x: .5, y: .45, boss: 'Лич', color: '#c87820' },
  { id: 'peaks', name: 'ГРОЗОВЫЕ ВЕРШИНЫ', sub: 'Зона III', x: .8, y: .35, boss: 'Титан Бури', color: '#00c8ff' },
];